//hugov@runbox.com
!function(t,s){function i(t){for(var s=Array(t),i=0;i<t;++i){var h=0===i?0:(i-2/t)/(t-1-2/t);s[i]=(15+10*h-30*h*h+12*h*h*h)*h*h/7}return s}function h(t,s){for(var i=0;i<t.length;++i)if(t[i]>=s)return i}function r(t){function s(t,s){if(++this.N,this.N===this.length&&(r=i.bind(this)),void 0===s)return this.values.push(t),void this.ranks.push(this.N);for(var h=s;h<this.ranks.length;++h)++this.ranks[h];0===s?(this.values.unshift(t),this.ranks.unshift(1)):(this.values.splice(s,0,t),this.ranks.splice(s,0,this.ranks[s-1]+1))}function i(t,s){if(++this.N,void 0===s)return void this._left(this.ranks.length-1,t,this.N);for(var i=s;i<this.ranks.length;++i)++this.ranks[i];if(0===s)return void this._right(s,t,1);if(t!==this.values[s]){var h=this.values[s],r=this.ranks[s],n=this.values[s-1],e=this.ranks[s-1],a=this.N*this.probs[s-1],u=this.N*this.probs[s],l=r-(r-e-1)*(h-t)/(h-n);l>u?this._right(s,t,l):l<a&&this._left(s-1,t,l)}}var r=s.bind(this);this.length=t.length,this.probs=t,this.values=[],this.ranks=[],this.N=0,this.push=function(t){if(Array.isArray(t))for(var s=0;s<t.length;++s)r(t[s],h(this.values,t[s]));else r(t,h(this.values,t))}}function n(t,s,i){if(t!==this.values.length-2){var h=this.values[t],r=this.ranks[t],n=this.N*this.probs[t+1];this.values[t]=s,this.ranks[t]=i,this.ranks[t+1]-1-n>=n-r+1&&this._right(t+1,h,r)}}function e(t,s,i){if(0!==t){var h=this.values[t],r=this.ranks[t],n=this.N*this.probs[t-1];this.values[t]=s,this.ranks[t]=i,n-this.ranks[t-1]>=r-n&&this._left(t-1,h,r)}}function a(t){if(Array.isArray(t))return t.map(this.quantile,this);var s=(this.N+1)*t,i=h(this.ranks,s),r=this.ranks[i],n=this.ranks[i-1];return i<1?this.values[0]:void 0===i?this.values[this.values.length-1]:this.values[i-1]+(this.values[i]-this.values[i-1])*(s-n)/(r-n)}module.exports=function(t){return new r(Array.isArray(t)?0===t[0]&&1===t[t.length-1]?t:t.reduce(function(t,s){return t.push(s),t},[0]).map(function(t,s,i){return t/i[i.length-1]}):i(t))},r.prototype={_right:n,_left:e,percentile:a,quantile:a,get min(){return this.values[0]},get max(){return this.values[this.values.length-1]}},s.miniQuant=t}({},function(){return this}());